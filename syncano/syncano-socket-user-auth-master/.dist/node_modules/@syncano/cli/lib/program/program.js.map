{"version":3,"sources":["../../src/program/program.js"],"names":["Command","prototype","missingArgument","name","cyan","red","outputHelp","process","exit","optionMissingArgument","option","flag","flags","group","_group","commandHelp","commands","length","plugins","Object","keys","getPluginsInstance","forEach","cmd","indexOf","_name","_plugin","humanReadableArgName","arg","nameOutput","variadic","required","white","grey","pad","str","width","len","Math","max","Array","join","printCmd","args","_args","map","_alias","options","_description","commandGroups","filter","_noHelp","push","pluginsCommands","printList","title","reduce","command","comnds","desc","replace","allCommands","groupName","concat","pluginsCommandsList","helpInformation","currentInstance","project","instance","instanceName","yellow","cmdName","usage","cmds","optionHelp"],"mappings":"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","file":"program.js","sourcesContent":["/* eslint no-underscore-dangle: \"warn\" */\n/* eslint no-param-reassign: \"warn\" */\n/* eslint no-underscore-dangle: 0 */\nimport program from 'commander'\nimport format from 'chalk'\nimport stripAnsi from 'strip-ansi'\nimport { echo } from '../utils/print-tools'\nimport session from '../utils/session'\n\nprogram.Command.prototype.missingArgument = (name) => {\n  echo(`\\nerror: ${format.cyan(`<${name}>`)} argument is ${format.red('required!')}`)\n  program.outputHelp()\n  process.exit(1)\n}\n\nprogram.Command.prototype.optionMissingArgument = (option, flag) => {\n  if (flag) {\n    echo(`\\nerror: missing ${format.cyan(`<${option.flags}>`)} argument, got ${format.red(flag)}`)\n  }\n\n  if (!flag) {\n    echo(`\\nerror: ${format.cyan(`${option.flags}`)} argument is ${format.red('required!')}`)\n  }\n\n  program.outputHelp()\n  process.exit(1)\n}\n\nprogram.Command.prototype.group = function (group) {\n  this._group = group // eslint-disable-line\n  return this\n}\n\n// We are overriding this mainly to show separetly normal command and plugins\nprogram.Command.prototype.commandHelp = () => {\n  if (!program.commands.length) return ''\n\n  // Search for plugins commands\n  const plugins = Object.keys(session.getPluginsInstance().plugins)\n  program.commands.forEach((cmd) => {\n    if (!plugins.indexOf(cmd._name)) { // eslint-disable-line\n      cmd._plugin = true // eslint-disable-line\n    }\n  })\n\n  function humanReadableArgName (arg) {\n    const nameOutput = arg.name + (arg.variadic === true ? '...' : '')\n    return arg.required ? `${format.white(`<${(nameOutput)}>`)}` : `${format.grey(`[${(nameOutput)}]`)}`\n  }\n\n  function pad (str, width) {\n    const len = Math.max(0, width - stripAnsi(str).length)\n    return str + Array(len + 1).join(' ')\n  }\n\n  function printCmd (cmd) {\n    const args = cmd._args.map((arg) => humanReadableArgName(arg)).join(' ') // eslint-disable-line\n\n    return [\n      [\n        format.cyan(cmd._name), // eslint-disable-line\n        (cmd._alias ? `|${cmd._alias}` : ''), // eslint-disable-line\n        format.grey((cmd.options.length ? ' [options]' : '')),\n        ' ',\n        args\n      ].join(''),\n      cmd._description\n    ]\n  }\n\n  const commandGroups = {}\n  // Grouping commands\n  program\n    .commands\n    .filter((cmd) => !cmd._noHelp && !cmd._plugin && cmd._name !== 'help')\n    .map((cmd) => {\n      let group = ''\n      if (cmd._group) {\n        group = cmd._group\n      } else {\n        group = 'Other'\n      }\n      if (!commandGroups[group]) { commandGroups[group] = [] }\n      commandGroups[group].push(printCmd(cmd))\n      return printCmd(cmd)\n    })\n\n  // Plugins commands\n  const pluginsCommands = program\n    .commands\n    .filter((cmd) => !cmd._noHelp && cmd._plugin)\n    .map((cmd) => printCmd(cmd))\n\n  function printList (commands, title) {\n    const width = commands.reduce((max, command) => Math.max(max, stripAnsi(command[0]).length), 0)\n    const comnds = commands.map((cmd) => {\n      const desc = cmd[1] ? `    ${cmd[1]}` : ''\n      return pad(cmd[0], width) + desc\n    }).join('\\n').replace(/^/gm, '    ')\n\n    return [\n      '',\n      `  ${format.grey(title)}:`,\n      '',\n      comnds,\n      ''\n    ].join('\\n')\n  }\n\n  let allCommands = []\n\n  Object.keys(commandGroups).forEach((groupName) => {\n    allCommands = allCommands.concat(printList(commandGroups[groupName], groupName))\n  })\n\n  const pluginsCommandsList = pluginsCommands.length ? printList(pluginsCommands, 'Plugins') : []\n\n  return allCommands.join('').concat(pluginsCommandsList)\n}\n\nprogram.Command.prototype.helpInformation = function () {\n  let currentInstance = ''\n  if (session.project && session.project.instance) {\n    const instanceName = session.project.instance\n    currentInstance = instanceName ? `\\n\\n  Current Instance: ${format.yellow((instanceName))}` : ''\n  }\n\n  const desc = this._description ? [`  ${this._description}`, ''] : []\n  const cmdName = this._alias ? `${this._name}|${this._alias}` : this._name\n  const usage = [`\\n  Usage: ${cmdName} ${this.usage()} ${currentInstance}`]\n\n  const commandHelp = this.commandHelp()\n\n  const cmds = commandHelp ? [commandHelp] : []\n  const options = [\n    '  Options:\\n',\n    `${this.optionHelp().replace(/^/gm, '    ')}\\n\\n`\n  ]\n\n  return usage\n    .concat(cmds)\n    .concat(desc)\n    .concat(options)\n    .join('\\n')\n}\n\nexport default program\n"]}