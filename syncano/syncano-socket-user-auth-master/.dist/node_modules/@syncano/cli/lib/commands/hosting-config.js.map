{"version":3,"sources":["../../src/commands/hosting-config.js"],"names":["HostingConfig","constructor","context","hosting","run","hostingName","cmd","cname","fullPath","get","existLocally","process","exit","removeCname","hasCNAME","responses","browser_router","prompt","getQuestions","paramsToUpdate","CNAME","removeCNAME","configure","green","err","response","data","detail","printErr","message","questions","push","name","default","getCNAME","type","config"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;AACA;;;;;;;;AAEA,MAAMA,aAAN,CAAoB;AAClBC,cAAaC,OAAb,EAAsB;AACpB,SAAKA,OAAL,GAAeA,OAAf;AACA,SAAKC,OAAL,GAAe,IAAf;AACD;;AAEKC,KAAN,CAAW,CAACC,WAAD,EAAcC,GAAd,CAAX,EAA+B;AAAA;;AAAA;AAC7B,YAAKC,KAAL,GAAaD,IAAIC,KAAjB;AACA,YAAKC,QAAL,GAAgB,IAAhB;;AAEA,UAAI;AACF,cAAKL,OAAL,GAAe,MAAM,kBAAQM,GAAR,CAAYJ,WAAZ,CAArB;;AAEA,YAAI,CAAC,MAAKF,OAAL,CAAaO,YAAlB,EAAgC;AAC9B,mCAAQ,CAAR,EAAW,kBAAX;AACA;AACAC,kBAAQC,IAAR,CAAa,CAAb;AACD;AACD,YAAIN,IAAIO,WAAJ,IAAmB,CAAC,MAAKV,OAAL,CAAaW,QAAb,CAAsBR,IAAIO,WAA1B,CAAxB,EAAgE;AAC9D,mCAAQ,CAAR,EAAW,wCAAX;AACA;AACAF,kBAAQC,IAAR,CAAa,CAAb;AACD;;AAED,YAAIG,YAAY,EAAhB;AACA,YAAI,EAAET,IAAIO,WAAJ,IAAmBP,IAAIC,KAAvB,IAAgCD,IAAIU,cAAtC,CAAJ,EAA2D;AACzDD,sBAAY,OAAM,mBAASE,MAAT,CAAgB,MAAKC,YAAL,EAAhB,CAAN,KAA8C,EAA1D;AACD;;AAED,cAAMC,iBAAiB;AACrBZ,iBAAO,MAAKA,KAAL,IAAcQ,UAAUK,KADV;AAErBC,uBAAaf,IAAIO,WAFI;AAGrBG,0BAAgBV,IAAIU,cAAJ,IAAsBD,UAAUC;AAH3B,SAAvB;;AAMA,cAAM,MAAKb,OAAL,CAAamB,SAAb,CAAuBH,cAAvB,CAAN;AACA,8BAAK,CAAL,EAAQ,gBAAOI,KAAP,CAAa,qCAAb,CAAR;AACA;AACD,OA5BD,CA4BE,OAAOC,GAAP,EAAY;AACZ,YAAI;AACF,iCAAM,CAAN,EAASA,IAAIC,QAAJ,CAAaC,IAAb,CAAkBC,MAA3B;AACD,SAFD,CAEE,OAAOC,QAAP,EAAiB;AACjB,iCAAM,CAAN,EAASA,SAASC,OAAlB;AACD;AACD;AACD;AAvC4B;AAwC9B;;AAEDX,iBAAgB;AACd,UAAMY,YAAY,EAAlB;;AAEA,QAAI,CAAC,KAAKvB,KAAV,EAAiB;AACfuB,gBAAUC,IAAV,CAAe;AACbC,cAAM,OADO;AAEbH,iBAAS,mBAAE,CAAF,EAAK,mDAAL,CAFI;AAGbI,iBAAS,KAAK9B,OAAL,CAAa+B,QAAb;AAHI,OAAf;AAKD;AACD,QAAI,CAAC,KAAKlB,cAAV,EAA0B;AACxBc,gBAAUC,IAAV,CAAe;AACbI,cAAM,SADO;AAEbH,cAAM,gBAFO;AAGbH,iBAAS,mBAAE,CAAF,EAAK,oDAAL,CAHI;AAIbI,iBAAS,KAAK9B,OAAL,CAAaiC,MAAb,CAAoBpB;AAJhB,OAAf;AAMD;;AAED,WAAOc,SAAP;AACD;AApEiB;;kBAuEL9B,a","file":"hosting-config.js","sourcesContent":["import format from 'chalk'\nimport inquirer from 'inquirer'\nimport { p, echo, error, warning } from '../utils/print-tools'\nimport Hosting from '../utils/hosting'\n\nclass HostingConfig {\n  constructor (context) {\n    this.context = context\n    this.hosting = null\n  }\n\n  async run ([hostingName, cmd]) {\n    this.cname = cmd.cname\n    this.fullPath = null\n\n    try {\n      this.hosting = await Hosting.get(hostingName)\n\n      if (!this.hosting.existLocally) {\n        warning(4)('No such hosting!')\n        echo()\n        process.exit(1)\n      }\n      if (cmd.removeCname && !this.hosting.hasCNAME(cmd.removeCname)) {\n        warning(4)('This hosting doesn\\'t have such CNAME!')\n        echo()\n        process.exit(1)\n      }\n\n      let responses = {}\n      if (!(cmd.removeCname || cmd.cname || cmd.browser_router)) {\n        responses = await inquirer.prompt(this.getQuestions()) || {}\n      }\n\n      const paramsToUpdate = {\n        cname: this.cname || responses.CNAME,\n        removeCNAME: cmd.removeCname,\n        browser_router: cmd.browser_router || responses.browser_router\n      }\n\n      await this.hosting.configure(paramsToUpdate)\n      echo(4)(format.green('Configuration successfully updated!'))\n      echo()\n    } catch (err) {\n      try {\n        error(4)(err.response.data.detail)\n      } catch (printErr) {\n        error(4)(printErr.message)\n      }\n      echo()\n    }\n  }\n\n  getQuestions () {\n    const questions = []\n\n    if (!this.cname) {\n      questions.push({\n        name: 'CNAME',\n        message: p(2)('Set CNAME now (your own domain) or leave it empty'),\n        default: this.hosting.getCNAME()\n      })\n    }\n    if (!this.browser_router) {\n      questions.push({\n        type: 'confirm',\n        name: 'browser_router',\n        message: p(2)('Do you want to use BrowserRouter for this hosting?'),\n        default: this.hosting.config.browser_router\n      })\n    }\n\n    return questions\n  }\n}\n\nexport default HostingConfig\n"]}